@PART[strl-rad-wrap?-*]:NEEDS[zzzz_KerbalismSystemHeat]
{
	refECReq = #$/MODULE[ModuleActiveRadiator]/RESOURCE/rate$
	
	!MODULE[ModuleAnimateHeat] {}
	MODULE
	{
		name = ModuleSystemHeatColorAnimator
		moduleID = heat
		useRate = false
		animRate = 1
		shaderProperty = _EmissiveColor
		toggleInEditor = false
		toggleInFlight = false
		redCurve
		{
			key = 0 1
			key = 1 1
		}
		greenCurve
		{
			key = 0 1
			key = 1 1
		}
		blueCurve
		{
			key = 0 1
			key = 1 1
		}
		alphaCurve
		{
			key = 0 0
			key = 1 1
		}
	}
	
	MODULE
	{
		name = ModuleSystemHeat
		volume = #$/refArea$
		@volume *= 0.01
		moduleID = default
		iconName = Icon_Radiator
		ignoreTemperature = true
	}
	@MODULE[ModuleActiveRadiator]
	{
		@name = SystemHeatRadiatorKerbalism
		moduleID = radiator
		// ModuleSystemHeat instance to link to
		systemHeatModuleID = default
		scalarModuleID = heat
		maxTempAnimation = 1400

		// option: use deterministic temperatures
		// Power radiated per temperature
		temperatureCurve
		{
			key = 0 0
			key = #$/refTemp$ $/refPower$
		}
		// area for convection
		convectiveArea = #$/refArea$
	}
}

@PART[strl-rad-wrap?-1??]:NEEDS[B9PartSwitch,zzzz_KerbalismSystemHeat]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[Height]]
	{
		@SUBTYPE[2x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower2$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 2
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 2
				}
			}
		}
		@SUBTYPE[4x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower4$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 4
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 4
				}
			}
		}
		@SUBTYPE[6x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower6$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 6
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 6
				}
			}
		}
		@SUBTYPE[8x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower8$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 8
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 8
				}
			}
		}
	}
}

@PART[strl-rad-wrap?-250|strl-rad-wrap?-375|strl-rad-wrap?-500]:NEEDS[B9PartSwitch,zzzz_KerbalismSystemHeat]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[Height]]
	{
		@SUBTYPE[2x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower2$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 2
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 2
				}
			}
		}
		@SUBTYPE[3x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower3$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 3
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 3
				}
			}
		}
		@SUBTYPE[4x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower4$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 4
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 4
				}
			}
		}
	}
}

@PART[strl-rad-wrap?-mk2]:NEEDS[B9PartSwitch,zzzz_KerbalismSystemHeat]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[Height]]
	{
		@SUBTYPE[2x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower2$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 2
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 2
				}
			}
		}
		@SUBTYPE[4x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower4$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 4
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 4
				}
			}
		}
		@SUBTYPE[8x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower8$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 8
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 8
				}
			}
		}
	}
}

@PART[strl-rad-wrap?-mk3]:NEEDS[B9PartSwitch,zzzz_KerbalismSystemHeat]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[Height]]
	{
		@SUBTYPE[2x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower2$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 2
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 2
				}
			}
		}
		@SUBTYPE[3x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower3$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 3
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 3
				}
			}
		}
		@SUBTYPE[4x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower4$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 4
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 4
				}
			}
		}
		@SUBTYPE[8x]
		{
			!MODULE {}
			MODULE
			{
				IDENTIFIER
				{
					name = SystemHeatRadiatorKerbalism
				}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = #$/refTemp$ $/refPower8$
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = #$/refECReq$
						@rate *= 8
					}
					convectiveArea = #$/refArea$
					@convectiveArea *= 8
				}
			}
		}
	}
}

@PART[strl-rad-sink-*]:NEEDS[zzzz_KerbalismSystemHeat]
{
	!MODULE[ModuleActiveRadiator] {}
	MODULE
	{
		name = ModuleSystemHeat
		// Cubic metres
		volume = #$/refVolume$
		@volume *= 6.12
		moduleID = sink
		iconName = Icon_Tank
		ignoreTemperature = true
	}
}

@PART[strl-shl-sun01]:NEEDS[zzzz_KerbalismSystemHeat]
{
	MODULE
	{
		name = ModuleSystemHeat
		volume = #$/mass$
		@volume /= 5
		moduleID = default
		iconName = Icon_Radiator
		ignoreTemperature = true
	}
	
	@MODULE[ModuleActiveRadiator]
	{
		@name = SystemHeatRadiatorKerbalism
		moduleID = radiator
		// ModuleSystemHeat instance to link to
		systemHeatModuleID = default
		scalarModuleID = heat
		maxTempAnimation = 1400

		// option: use deterministic temperatures
		// Power radiated per temperature
		temperatureCurve
		{
			key = 0 0
			key = 1000 0
		}
		// area for convection
		convectiveArea = #$/refArea10$
	}
	
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[Service]]
	{
		@SUBTYPE,*
		{
			@MODULE:HAS[@IDENTIFIER[ModuleActiveRadiator]]
			{
				@IDENTIFIER
				{
					@name = SystemHeatRadiatorKerbalism
				}
				!DATA {}
				DATA
				{
					temperatureCurve
					{
						key = 0 0
						key = 0 0
					}
					RESOURCE
					{
						name = ElectricCharge
						rate = 0
					}
					convectiveArea = 0
				}
			}
		}
		@SUBTYPE[10-2]
		{
			@MODULE:HAS[@IDENTIFIER[SystemHeatRadiatorKerbalism]]
			{
				@DATA
				{
					@temperatureCurve
					{
						@key,1 = 1000 518
					}
					@RESOURCE
					{
						@rate = 2.946
					}
					@convectiveArea = #$/refArea10$
				}
			}
		}
		@SUBTYPE[25-2]
		{
			@MODULE:HAS[@IDENTIFIER[SystemHeatRadiatorKerbalism]]
			{
				@DATA
				{
					@temperatureCurve
					{
						@key,1 = 1000 3682
					}
					@RESOURCE
					{
						@rate = 18.408
					}
					@convectiveArea = #$/refArea25$
				}
			}
		}
		@SUBTYPE[50-2a]
		{
			@MODULE:HAS[@IDENTIFIER[SystemHeatRadiatorKerbalism]]
			{
				@DATA
				{
					@temperatureCurve
					{
						@key,1 = 1000 14727
					}
					@RESOURCE
					{
						@rate = 73.632
					}
					@convectiveArea = #$/refArea50a$
				}
			}
		}
		@SUBTYPE[50-2b]
		{
			@MODULE:HAS[@IDENTIFIER[SystemHeatRadiatorKerbalism]]
			{
				@DATA
				{
					@temperatureCurve
					{
						@key,1 = 1000 11045
					}
					@RESOURCE
					{
						@rate = 55.224
					}
					@convectiveArea = #$/refArea50b$
				}
			}
		}
	}
}


@PART[strl-shl-shadow01]:NEEDS[zzzz_KerbalismSystemHeat]
{
	MODULE
	{
		name = ModuleSystemHeat
		// Cubic metres
		volume = 1.23
		@volume = 6.12
		moduleID = sink
		iconName = Icon_Tank
		ignoreTemperature = true
	}
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[Span]]
	{
		@SUBTYPE[s1]
		{
			%descriptionSummary = #$@STRLB9LOC/txtsysheat$ $@STRLB9LOC/txtsysheatvol$ 6.12 m³
		}
		@SUBTYPE[s1p5]
		{
			%descriptionSummary = #$@STRLB9LOC/txtsysheat$ $@STRLB9LOC/txtsysheatvol$ 7.53 m³
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleSystemHeat
				}
				DATA
				{
					volume = 7.53 // 1.23
				}
			}
		}
		@SUBTYPE[s1p5]
		{
			%descriptionSummary = #$@STRLB9LOC/txtsysheat$ $@STRLB9LOC/txtsysheatvol$ 16.89 m³
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleSystemHeat
				}
				DATA
				{
					volume = 16.89 // 2.76
				}
			}
		}
		@SUBTYPE[s2]
		{
			%descriptionSummary = #$@STRLB9LOC/txtsysheat$ $@STRLB9LOC/txtsysheatvol$ 30 m³
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleSystemHeat
				}
				DATA
				{
					volume = 30 // 4.9
				}
			}
		}
		@SUBTYPE[s3]
		{
			%descriptionSummary = #$@STRLB9LOC/txtsysheat$ $@STRLB9LOC/txtsysheatvol$ 67.56 m³
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleSystemHeat
				}
				DATA
				{
					volume = 67.56 // 11.04
				}
			}
		}
		@SUBTYPE[s4]
		{
			%descriptionSummary = #$@STRLB9LOC/txtsysheat$ $@STRLB9LOC/txtsysheatvol$ 120.14 m³
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleSystemHeat
				}
				DATA
				{
					volume = 120.14 // 19.63
				}
			}
		}
	}
}