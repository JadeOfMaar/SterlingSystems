PART:NEEDS[ProceduralParts]
{
	// --- general parameters ---
	name = strl-tank-proc-fi
	module = Part
	author = AncientGammoner, NathanKell, Swamp Ig

	// --- asset parameters ---
	MODEL
	{
		model = ProceduralParts/Parts/cylinderTank
		scale = 1,1,1
	}
	scale = 1
	rescaleFactor = 1

	// --- node definitions ---
	node_stack_top=0,0.5,0,0,1,0,1
	node_stack_bottom=0,-0.5,0,0,-1,0,1
	node_attach=0,0,0.5,0,0,-1,1

	// --- editor parameters ---
	cost = 0 // 4000
	TechRequired = basicRocketry
	entryCost = 4000
	category = FuelTank
	subcategory = 0
	title = Sterling Procedural Fissiles Tank
	manufacturer = Kerbchem Industries
	description = Made from viscoelastic nanopolymers (which were discovered by accident... growing in the back of the office mini-fridge) this fuel tank can be stretched to accommodate fuel loads of a range of sizes and shapes. Hardens to a rigid structure before launch!

	// attachment rules: stack, srfAttach, allowStack, allowSrfAttach, allowCollision
	attachRules = 1,1,1,1,0

	// --- standard part parameters ---
	mass = 1
	dragModelType = default
	maximum_drag = 0.2
	minimum_drag = 0.2
	angularDrag = 2
	crashTolerance = 7
	breakingForce = 200
	breakingTorque = 200
	maxTemp = 2000
	bulkheadProfiles = size1, srf

	MODULE
	{
		name = ProceduralPart
		%textureSet = GreySide
		shapeName = Cylinder // Setting the default shapeName to a hollow shape breaks surface attaching for a new part. Placing it and picking it up again fixes the issue.
		
		// FL-T100 (basicRocketry) - 1.25 x 0.78125 m = 0.959 kL
		diameterMin = 1.0
		diameterMax = 1.5
		lengthMin = 0.5
		lengthMax = 0.75
		volumeMin = 0.6
		volumeMax = 0.8

		UPGRADES
		{
			UPGRADE
			{
				// FL-T200 - 1.25 x 1.1105 m = 1.363 kL
				name__ = ProceduralPartsTank1500L
				lengthMax = 1.5
				volumeMax = 1.5
			}
			UPGRADE
			{
				// FL-T400 - 1.25 x 1.87819 m = 2.305 kL
				name__ = ProceduralPartsTank2500L
				lengthMax = 2.0
				volumeMax = 2.5
			}
			UPGRADE
			{
				// Mk0
				name__ = ProceduralPartsTankAviation
				diameterMin = 0.625
				volumeMin = 0.3
			}
			UPGRADE
			{
				// FL-T800 - 1.25 x 3.75 m = 4.602 kL
				// X200-32 - 2.5 x 3.75 m = 18.408 kL
				name__ = ProceduralPartsTank20000L
				lengthMax = 4.0
				diameterMax = 3.0
				volumeMax = 20
			}
			UPGRADE
			{
				// Jumbo-64 - 2.5 x 7.5 m = 36.816 kL
				name__ = ProceduralPartsTank37000L
				lengthMax = 8.0
				volumeMax = 37.0
			}
			UPGRADE
			{
				// Kerbodyne S3-7200 - 3.75 x 4.0
				name__ = ProceduralPartsTank45000L
				diameterMax = 5.0
				volumeMax = 45.0
			}
			UPGRADE
			{
				// Kerbodyne S3-14400 - 3.75 x 7.5 = 82.614kl
				name__ = ProceduralPartsTank85000L
//				diameterMax = 5.0
				volumeMax = 85.0
			}
			UPGRADE
			{
				// Oscar-B - 0.625 x 0.3485474 m = 0.107 kL.  Not in main sequence. Depends indirectly off basicRocketry
				name__ = ProceduralPartsTankMiniaturization
				diameterMin = 0.125
				lengthMin = 0.125
				volumeMin = 0.0625
			}
			UPGRADE
			{
				name__ = ProceduralPartsTankUnlimited
				diameterMin = 0.01
				diameterMax = Infinity
				lengthMin = 0.01
				lengthMax = Infinity
				volumeMin = 0
				volumeMax = Infinity
			}
		}
	}
	MODULE
	{
		name = ProceduralShapeCylinder
		displayName = Cylinder
		techRequired = start
		
		length = 0.75
		diameter = 1
	}
	MODULE 
	{
		name = ProceduralShapeCone
		displayName = Cone
		techRequired = generalConstruction
		
		length = 0.5
		topDiameter = 1
		bottomDiameter = 1.25
	}
	MODULE 
	{
		name = ProceduralShapePill
		displayName = Fillet Cylinder
		techRequired = advConstruction
		
		length = 0.75
		diameter = 1
		fillet = 0.25
	}
	MODULE 
	{
		name = ProceduralShapeBezierCone
		displayName = Smooth Cone
		techRequired = advConstruction
		
		selectedShape = Round1
		
		length = 0.5
		topDiameter = 1.0
		bottomDiameter = 1.25
	}
	MODULE
	{
		name = ProceduralShapePolygon
		displayName = Polygon
		techRequired = start
		
		length = 0.75
		diameter = 1.0
	}
	MODULE
	{
		name = ProceduralShapeHollowCylinder
		displayName = Hollow Cylinder
		techRequired = start
		length = 0.75
		innerDiameter = 0.5
		outerDiameter = 1
	}
	MODULE
	{
		name = ProceduralShapeHollowCone
		displayName = Hollow Cone
		techRequired = start
		length = 0.5
		topInnerDiameter = 0.5
		topOuterDiameter = 1
		bottomInnerDiameter = 0.5
		bottomOuterDiameter = 1.25
	}
	MODULE
	{
		name = ProceduralShapeHollowPill
		displayName = Hollow Fillet Cylinder
		techRequired = start
		
		length = 0.75
		innerDiameter = 0.5
		outerDiameter = 1
		fillet = 0.25
	}
	MODULE
	{
		name = TankContentSwitcher
		useVolume = true
		
		TANK_TYPE_OPTION
		{
			name = LithiumSaltWater
			dryDensity = 0.1089
			@dryDensity:NEEDS[SMURFF] /= #$@SMURFFCONFIG/lfofactor$
			costMultiplier = 1.0
			RESOURCE 
			{
				name = LithiumSaltWater
				unitsPerKL = 872
			}
		}
		TANK_TYPE_OPTION
		{
			name = NuclearSaltWater
			dryDensity = 0.1089
			@dryDensity:NEEDS[SMURFF] /= #$@SMURFFCONFIG/lfofactor$
			costMultiplier = 1.0
			RESOURCE 
			{
				name = NuclearSaltWater
				unitsPerKL = 872
			}
		}
		TANK_TYPE_OPTION
		{
			name = Tritium
			dryDensity = 0.1089
			@dryDensity:NEEDS[SMURFF] /= #$@SMURFFCONFIG/lfofactor$
			costMultiplier = 1.0
			RESOURCE 
			{
				name = Tritium
				unitsPerKL = 872
			}
		}
		TANK_TYPE_OPTION
		{
			name = FissilePebbles
			dryDensity = 0.1089
			@dryDensity:NEEDS[SMURFF] /= #$@SMURFFCONFIG/lfofactor$
			costMultiplier = 1.0
			RESOURCE 
			{
				name = FissilePebbles
				unitsPerKL = 872
			}
		}
		TANK_TYPE_OPTION
		{
			name = FizzledPebbles
			dryDensity = 0.1089
			@dryDensity:NEEDS[SMURFF] /= #$@SMURFFCONFIG/lfofactor$
			costMultiplier = 1.0
			RESOURCE 
			{
				name = FizzledPebbles
				unitsPerKL = 872
			}
		}
		TANK_TYPE_OPTION
		{
			name = MMPU
			dryDensity = 0.1089
			@dryDensity:NEEDS[SMURFF] /= #$@SMURFFCONFIG/lfofactor$
			costMultiplier = 1.0
			RESOURCE 
			{
				name = MMPU
				unitsPerKL = 872
			}
		}
	}
}

+PART[strl-tank-proc-fi]:NEEDS[ProceduralParts,CommunityResourcePack]
{
	@name = strl-tank-proc-fu
	@title = Sterling Procedural Fusor Tank
	
	@MODULE[ProceduralPart]
	{
		%textureSet = Copernicus
	}
	
	@MODULE[TankContentSwitcher]
	{
		!TANK_TYPE_OPTION,* {}
	}
	@MODULE[TankContentSwitcher]:NEEDS[CommunityResourcePack]
	{
		TANK_TYPE_OPTION
		{
			name = LqdDeuterium
			dryDensity = 0.0233 // match CryoTanks 10m sphere
			costMultiplier = 1.0
			RESOURCE 
			{
				name = LqdDeuterium
				unitsPerT = 37888
			}
		}
		TANK_TYPE_OPTION
		{
			name = LqdHe3
			dryDensity = 0.0233 // match CryoTanks 10m sphere
			costMultiplier = 1.0
			RESOURCE 
			{
				name = LqdHe3
				unitsPerT = 56656
			}
		}
		TANK_TYPE_OPTION
		{
			name = D+He3
			dryDensity = 0.0233 // match CryoTanks 10m sphere
			costMultiplier = 1.0
			RESOURCE 
			{
				name = LqdDeuterium
				unitsPerT = 18944
			}
			RESOURCE 
			{
				name = LqdHe3
				unitsPerT = 75776
			}
		}
		TANK_TYPE_OPTION:NEEDS[!CryoTanks]
		{
			name = LqdHydrogen
			dryDensity = 0.1089
			// handled by stock smurff
			costMultiplier = 1.0
			RESOURCE 
			{
				name = LqdHydrogen
				unitsPerT = 24000 // 15
			}
		}
		TANK_TYPE_OPTION:NEEDS[!CryoTanks]
		{
			name = FusionPellets
			dryDensity = 0.1089
			// handled by stock smurff
			costMultiplier = 1.0
			RESOURCE 
			{
				name = FusionPellets
				unitsPerT = 37888
			}
		}
		TANK_TYPE_OPTION
		{
			name = Antimatter
			dryDensity = 0.0233 // match CryoTanks 10m sphere
			costMultiplier = 1.0
			RESOURCE 
			{
				name = Antimatter
				unitsPerT = 7576
			}
		}
	}
}